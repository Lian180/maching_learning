2025-07-22 19:31:13,897 - INFO - --- 机器学习房屋价格预测项目 (深度学习版) - 集成FT-Transformer和Optuna启动 ---
2025-07-22 19:31:13,900 - INFO - 已设置随机种子为: 42
2025-07-22 19:31:13,900 - INFO - 
--- Phase 1: Data Acquisition, Exploration, and Preprocessing ---
2025-07-22 19:31:13,923 - INFO - 数据从 './data/california_housing.csv' 加载成功！
2025-07-22 19:31:13,923 - INFO - 
--- 数据概览 ---
2025-07-22 19:31:13,924 - INFO - 数据前5行:
2025-07-22 19:31:13,924 - INFO -    MedInc  HouseAge  AveRooms  AveBedrms  Population  AveOccup  Latitude  Longitude  MedHouseVal  target
0  8.3252      41.0  6.984127   1.023810       322.0  2.555556     37.88    -122.23        4.526   4.526
1  8.3014      21.0  6.238137   0.971880      2401.0  2.109842     37.86    -122.22        3.585   3.585
2  7.2574      52.0  8.288136   1.073446       496.0  2.802260     37.85    -122.24        3.521   3.521
3  5.6431      52.0  5.817352   1.073059       558.0  2.547945     37.85    -122.25        3.413   3.413
4  3.8462      52.0  6.281853   1.081081       565.0  2.181467     37.85    -122.25        3.422   3.422
2025-07-22 19:31:13,947 - INFO - 
数据基本信息:
2025-07-22 19:31:13,951 - INFO - <class 'pandas.core.frame.DataFrame'>
RangeIndex: 20640 entries, 0 to 20639
Data columns (total 10 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   MedInc       20640 non-null  float64
 1   HouseAge     20640 non-null  float64
 2   AveRooms     20640 non-null  float64
 3   AveBedrms    20640 non-null  float64
 4   Population   20640 non-null  float64
 5   AveOccup     20640 non-null  float64
 6   Latitude     20640 non-null  float64
 7   Longitude    20640 non-null  float64
 8   MedHouseVal  20640 non-null  float64
 9   target       20640 non-null  float64
dtypes: float64(10)
memory usage: 1.6 MB

2025-07-22 19:31:13,951 - INFO - 
描述性统计:
2025-07-22 19:31:13,968 - INFO -              MedInc      HouseAge      AveRooms     AveBedrms    Population      AveOccup      Latitude     Longitude   MedHouseVal        target
count  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000
mean       3.870671     28.639486      5.429000      1.096675   1425.476744      3.070655     35.631861   -119.569704      2.068558      2.068558
std        1.899822     12.585558      2.474173      0.473911   1132.462122     10.386050      2.135952      2.003532      1.153956      1.153956
min        0.499900      1.000000      0.846154      0.333333      3.000000      0.692308     32.540000   -124.350000      0.149990      0.149990
25%        2.563400     18.000000      4.440716      1.006079    787.000000      2.429741     33.930000   -121.800000      1.196000      1.196000
50%        3.534800     29.000000      5.229129      1.048780   1166.000000      2.818116     34.260000   -118.490000      1.797000      1.797000
75%        4.743250     37.000000      6.052381      1.099526   1725.000000      3.282261     37.710000   -118.010000      2.647250      2.647250
max       15.000100     52.000000    141.909091     34.066667  35682.000000   1243.333333     41.950000   -114.310000      5.000010      5.000010
2025-07-22 19:31:13,981 - INFO - 
缺失值检查:
2025-07-22 19:31:13,983 - INFO - MedInc         0
HouseAge       0
AveRooms       0
AveBedrms      0
Population     0
AveOccup       0
Latitude       0
Longitude      0
MedHouseVal    0
target         0
dtype: int64
2025-07-22 19:31:13,984 - INFO - 
数据初步探索完成。
2025-07-22 19:31:13,984 - INFO - 
--- 数据初步可视化 ---
2025-07-22 19:31:14,364 - INFO - 图表已保存到: logs\房屋价格分布.png
2025-07-22 19:31:16,931 - INFO - 图表已保存到: logs\特征与房价散点图.png
2025-07-22 19:31:19,687 - INFO - 
数据初步可视化完成。
2025-07-22 19:31:19,688 - INFO - 
--- 缺失值处理 ---
2025-07-22 19:31:19,689 - INFO - 数据集中没有发现缺失值。
2025-07-22 19:31:19,690 - INFO - 
--- 异常值处理 ---
2025-07-22 19:31:19,707 - INFO - 已使用 IQR 方法处理 5594 个异常值 (替换为边界值)。
2025-07-22 19:31:19,707 - INFO - 
--- 特征工程 ---
2025-07-22 19:31:19,709 - INFO - 已创建新特征 'Bedrms_Per_Room'。
2025-07-22 19:31:19,711 - INFO - 已创建新特征 'Population_Density'。
2025-07-22 19:31:19,711 - INFO - 已创建新特征 'Lat_x_Lon'。
2025-07-22 19:31:19,711 - INFO - 特征工程完成。
2025-07-22 19:31:19,712 - INFO - 
--- 数据划分与特征缩放 ---
2025-07-22 19:31:19,716 - INFO - 选择 StandardScaler 进行特征缩放。
2025-07-22 19:31:19,721 - INFO - 训练集特征形状: (16512, 12)
2025-07-22 19:31:19,721 - INFO - 测试集特征形状: (4128, 12)
2025-07-22 19:31:19,722 - INFO - 训练集目标形状: (16512,)
2025-07-22 19:31:19,722 - INFO - 测试集目标形状: (4128,)
2025-07-22 19:31:19,722 - INFO - 数据划分与特征缩放完成。
2025-07-22 19:31:19,723 - INFO - 
--- 数据划分与特征缩放 ---
2025-07-22 19:31:19,727 - INFO - 不进行特征缩放。
2025-07-22 19:31:19,727 - INFO - 训练集特征形状: (12384, 12)
2025-07-22 19:31:19,727 - INFO - 测试集特征形状: (4128, 12)
2025-07-22 19:31:19,727 - INFO - 训练集目标形状: (12384,)
2025-07-22 19:31:19,727 - INFO - 测试集目标形状: (4128,)
2025-07-22 19:31:19,727 - INFO - 数据划分与特征缩放完成。
2025-07-22 19:31:19,731 - INFO - Scaler saved to: ./models/scaler_ftt_optuna.pkl
2025-07-22 19:31:19,735 - INFO - 
Training set features shape (Tensor): torch.Size([12384, 12])
2025-07-22 19:31:19,735 - INFO - Validation set features shape (Tensor): torch.Size([4128, 12])
2025-07-22 19:31:19,735 - INFO - Test set features shape (Tensor): torch.Size([4128, 12])
2025-07-22 19:31:19,735 - INFO - Training set target shape (Tensor): torch.Size([12384, 1])
2025-07-22 19:31:19,736 - INFO - Validation set target shape (Tensor): torch.Size([4128, 1])
2025-07-22 19:31:19,736 - INFO - Test set target shape (Tensor): torch.Size([4128, 1])
2025-07-22 19:31:19,736 - INFO - Training data loader contains 194 batches.
2025-07-22 19:31:19,736 - INFO - Validation data loader contains 65 batches.
2025-07-22 19:31:19,736 - INFO - Test data loader contains 65 batches.
2025-07-22 19:31:19,736 - INFO - 
--- Phase 2: Hyperparameter Optimization (Optuna) ---
2025-07-22 19:31:19,736 - INFO - 
--- 开始 Optuna 超参数优化 (共 50 次试验) ---
2025-07-22 19:31:21,875 - INFO - Trial 0: 选择了 MLP 模型
2025-07-22 19:31:23,643 - INFO - 
--- 模型训练开始 ---
2025-07-22 19:31:25,312 - INFO - Epoch [1/100], 训练损失: 0.1642, 验证损失: 0.0184, 验证 R2: 0.9866
2025-07-22 19:31:26,215 - INFO - Epoch [2/100], 训练损失: 0.0029, 验证损失: 0.0014, 验证 R2: 0.9990
2025-07-22 19:31:27,042 - INFO - Epoch [3/100], 训练损失: 0.0013, 验证损失: 0.0014, 验证 R2: 0.9990
2025-07-22 19:31:27,897 - INFO - Epoch [4/100], 训练损失: 0.0011, 验证损失: 0.0010, 验证 R2: 0.9993
2025-07-22 19:31:28,816 - INFO - Epoch [5/100], 训练损失: 0.0009, 验证损失: 0.0017, 验证 R2: 0.9987
2025-07-22 19:31:29,805 - INFO - Epoch [6/100], 训练损失: 0.0011, 验证损失: 0.0019, 验证 R2: 0.9986
2025-07-22 19:31:30,722 - INFO - Epoch [7/100], 训练损失: 0.0012, 验证损失: 0.0023, 验证 R2: 0.9984
2025-07-22 19:31:31,589 - INFO - Epoch [8/100], 训练损失: 0.0015, 验证损失: 0.0014, 验证 R2: 0.9990
2025-07-22 19:31:32,525 - INFO - Epoch [9/100], 训练损失: 0.0007, 验证损失: 0.0013, 验证 R2: 0.9990
2025-07-22 19:31:33,474 - INFO - Epoch [10/100], 训练损失: 0.0017, 验证损失: 0.0021, 验证 R2: 0.9985
2025-07-22 19:31:34,216 - INFO - Epoch [11/100], 训练损失: 0.0006, 验证损失: 0.0010, 验证 R2: 0.9993
2025-07-22 19:31:34,965 - INFO - Epoch [12/100], 训练损失: 0.0004, 验证损失: 0.0009, 验证 R2: 0.9994
2025-07-22 19:31:35,695 - INFO - Epoch [13/100], 训练损失: 0.0004, 验证损失: 0.0005, 验证 R2: 0.9996
2025-07-22 19:31:36,402 - INFO - Epoch [14/100], 训练损失: 0.0004, 验证损失: 0.0005, 验证 R2: 0.9997
2025-07-22 19:31:37,108 - INFO - Epoch [15/100], 训练损失: 0.0004, 验证损失: 0.0006, 验证 R2: 0.9996
2025-07-22 19:31:37,792 - INFO - Epoch [16/100], 训练损失: 0.0005, 验证损失: 0.0008, 验证 R2: 0.9994
2025-07-22 19:31:38,502 - INFO - Epoch [17/100], 训练损失: 0.0007, 验证损失: 0.0005, 验证 R2: 0.9996
2025-07-22 19:31:39,248 - INFO - Epoch [18/100], 训练损失: 0.0007, 验证损失: 0.0011, 验证 R2: 0.9992
2025-07-22 19:31:39,972 - INFO - Epoch [19/100], 训练损失: 0.0008, 验证损失: 0.0007, 验证 R2: 0.9995
2025-07-22 19:31:40,662 - INFO - Epoch [20/100], 训练损失: 0.0005, 验证损失: 0.0005, 验证 R2: 0.9996
2025-07-22 19:31:41,551 - INFO - Epoch [21/100], 训练损失: 0.0003, 验证损失: 0.0005, 验证 R2: 0.9996
2025-07-22 19:31:42,286 - INFO - Epoch [22/100], 训练损失: 0.0002, 验证损失: 0.0006, 验证 R2: 0.9996
2025-07-22 19:31:42,982 - INFO - Epoch [23/100], 训练损失: 0.0003, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:31:43,670 - INFO - Epoch [24/100], 训练损失: 0.0003, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:31:44,403 - INFO - Epoch [25/100], 训练损失: 0.0003, 验证损失: 0.0005, 验证 R2: 0.9996
2025-07-22 19:31:45,128 - INFO - Epoch [26/100], 训练损失: 0.0003, 验证损失: 0.0005, 验证 R2: 0.9996
2025-07-22 19:31:45,874 - INFO - Epoch [27/100], 训练损失: 0.0003, 验证损失: 0.0007, 验证 R2: 0.9995
2025-07-22 19:31:46,603 - INFO - Epoch [28/100], 训练损失: 0.0004, 验证损失: 0.0006, 验证 R2: 0.9996
2025-07-22 19:31:47,318 - INFO - Epoch [29/100], 训练损失: 0.0003, 验证损失: 0.0009, 验证 R2: 0.9993
2025-07-22 19:31:48,083 - INFO - Epoch [30/100], 训练损失: 0.0002, 验证损失: 0.0003, 验证 R2: 0.9998
2025-07-22 19:31:48,850 - INFO - Epoch [31/100], 训练损失: 0.0002, 验证损失: 0.0005, 验证 R2: 0.9996
2025-07-22 19:31:49,621 - INFO - Epoch [32/100], 训练损失: 0.0002, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:31:50,348 - INFO - Epoch [33/100], 训练损失: 0.0002, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:31:51,058 - INFO - Epoch [34/100], 训练损失: 0.0002, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:31:51,787 - INFO - Epoch [35/100], 训练损失: 0.0003, 验证损失: 0.0005, 验证 R2: 0.9996
2025-07-22 19:31:52,492 - INFO - Epoch [36/100], 训练损失: 0.0002, 验证损失: 0.0003, 验证 R2: 0.9998
2025-07-22 19:31:53,291 - INFO - Epoch [37/100], 训练损失: 0.0002, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:31:54,102 - INFO - Epoch [38/100], 训练损失: 0.0003, 验证损失: 0.0005, 验证 R2: 0.9996
2025-07-22 19:31:54,942 - INFO - Epoch [39/100], 训练损失: 0.0002, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:31:55,770 - INFO - Epoch [40/100], 训练损失: 0.0003, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:31:55,770 - INFO - 早停！验证损失在 10 个epoch内没有显著改善。
2025-07-22 19:31:55,771 - INFO - --- 模型训练完成 ---
2025-07-22 19:31:56,087 - INFO - 图表已保存到: logs\训练与验证损失曲线.png
2025-07-22 19:31:58,904 - INFO - 图表已保存到: logs\验证集R2分数曲线.png
2025-07-22 19:32:00,279 - INFO - Trial 1: 选择了 FT-Transformer 模型
2025-07-22 19:32:00,280 - INFO - 
--- 模型训练开始 ---
