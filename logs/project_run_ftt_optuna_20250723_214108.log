2025-07-23 21:41:08,324 - INFO - --- 机器学习房屋价格预测项目 (深度学习版) - 集成FT-Transformer和Optuna启动 ---
2025-07-23 21:41:08,328 - INFO - 已设置随机种子为: 42
2025-07-23 21:41:08,329 - INFO - 
--- 阶段1: 数据获取、探索与预处理 ---
2025-07-23 21:41:08,349 - INFO - 数据从 './data/california_housing.csv' 加载成功！
2025-07-23 21:41:08,350 - INFO - 
--- 数据概览 ---
2025-07-23 21:41:08,350 - INFO - 数据前5行:
2025-07-23 21:41:08,350 - INFO -    MedInc  HouseAge  AveRooms  AveBedrms  Population  AveOccup  Latitude  Longitude  target
0  8.3252        41  6.984127   1.023810         322  2.555556     37.88    -122.23   4.526
1  8.3014        21  6.238137   0.971880        2401  2.109842     37.86    -122.22   3.585
2  7.2574        52  8.288136   1.073446         496  2.802260     37.85    -122.24   3.521
3  5.6431        52  5.817352   1.073059         558  2.547945     37.85    -122.25   3.413
4  3.8462        52  6.281853   1.081081         565  2.181467     37.85    -122.25   3.422
2025-07-23 21:41:08,365 - INFO - 
数据基本信息:
2025-07-23 21:41:08,369 - INFO - <class 'pandas.core.frame.DataFrame'>
RangeIndex: 20640 entries, 0 to 20639
Data columns (total 9 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   MedInc      20640 non-null  float64
 1   HouseAge    20640 non-null  int64  
 2   AveRooms    20640 non-null  float64
 3   AveBedrms   20640 non-null  float64
 4   Population  20640 non-null  int64  
 5   AveOccup    20640 non-null  float64
 6   Latitude    20640 non-null  float64
 7   Longitude   20640 non-null  float64
 8   target      20640 non-null  float64
dtypes: float64(7), int64(2)
memory usage: 1.4 MB

2025-07-23 21:41:08,369 - INFO - 
描述性统计:
2025-07-23 21:41:08,382 - INFO -              MedInc      HouseAge      AveRooms     AveBedrms    Population      AveOccup      Latitude     Longitude        target
count  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000
mean       3.870671     28.639486      5.429000      1.096675   1425.476744      3.070655     35.631861   -119.569704      2.068558
std        1.899822     12.585558      2.474173      0.473911   1132.462122     10.386050      2.135952      2.003532      1.153956
min        0.499900      1.000000      0.846154      0.333333      3.000000      0.692308     32.540000   -124.350000      0.149990
25%        2.563400     18.000000      4.440716      1.006079    787.000000      2.429741     33.930000   -121.800000      1.196000
50%        3.534800     29.000000      5.229129      1.048780   1166.000000      2.818116     34.260000   -118.490000      1.797000
75%        4.743250     37.000000      6.052381      1.099526   1725.000000      3.282261     37.710000   -118.010000      2.647250
max       15.000100     52.000000    141.909091     34.066667  35682.000000   1243.333333     41.950000   -114.310000      5.000010
2025-07-23 21:41:08,394 - INFO - 
缺失值检查:
2025-07-23 21:41:08,394 - INFO - MedInc        0
HouseAge      0
AveRooms      0
AveBedrms     0
Population    0
AveOccup      0
Latitude      0
Longitude     0
target        0
dtype: int64
2025-07-23 21:41:08,395 - INFO - 
数据初步探索完成。
2025-07-23 21:41:08,395 - INFO - 
--- 数据初步可视化 ---
2025-07-23 21:41:08,861 - INFO - 图表已保存到: logs\房屋价格分布.png
2025-07-23 21:41:11,318 - INFO - 图表已保存到: logs\特征与房价散点图.png
2025-07-23 21:41:14,438 - INFO - 
数据初步可视化完成。
2025-07-23 21:41:14,439 - INFO - 
--- 缺失值处理 ---
2025-07-23 21:41:14,439 - INFO - 数据集中没有发现缺失值。
2025-07-23 21:41:14,440 - INFO - 
--- 异常值处理 ---
2025-07-23 21:41:14,461 - INFO - 已使用 IQR 方法处理 4523 个异常值 (替换为边界值)。
2025-07-23 21:41:14,461 - INFO - 
--- 特征工程 ---
2025-07-23 21:41:14,463 - INFO - 已创建新特征 'Bedrms_Per_Room'。
2025-07-23 21:41:14,469 - INFO - 已创建新特征 'Population_Density_Geo' (基于地理分桶)。
2025-07-23 21:41:14,470 - INFO - 已创建新特征 'Lat_x_Lon'。
2025-07-23 21:41:14,476 - INFO - 已创建经纬度多项式特征。
2025-07-23 21:41:14,478 - INFO - 已创建新特征 'HouseAge_sq' 和 'HouseAge_log'。
2025-07-23 21:41:14,479 - INFO - 已创建新特征 'MedInc_x_AveRooms'。
2025-07-23 21:41:14,480 - INFO - 已创建新特征 'Rooms_Per_Person'。
2025-07-23 21:41:14,480 - INFO - 特征工程完成。
2025-07-23 21:41:14,480 - INFO - 
--- 数据划分与特征缩放 ---
2025-07-23 21:41:14,487 - INFO - 选择 StandardScaler 进行特征缩放。
2025-07-23 21:41:14,499 - INFO - 目标变量已使用 StandardScaler 进行缩放。
2025-07-23 21:41:14,500 - INFO - 训练集特征形状: (18576, 18)
2025-07-23 21:41:14,500 - INFO - 测试集特征形状: (2064, 18)
2025-07-23 21:41:14,500 - INFO - 训练集目标形状: (18576,)
2025-07-23 21:41:14,500 - INFO - 测试集目标形状: (2064,)
2025-07-23 21:41:14,501 - INFO - 数据划分与特征缩放完成。
2025-07-23 21:41:14,512 - INFO - 特征标准化器已保存到: ./models/scaler_ftt_optuna.pkl
2025-07-23 21:41:14,512 - INFO - 目标标准化器已保存到: ./models/target_scaler_ftt_optuna.pkl
2025-07-23 21:41:14,517 - INFO - 
训练集特征形状 (Tensor): torch.Size([13932, 18])
2025-07-23 21:41:14,517 - INFO - 验证集特征形状 (Tensor): torch.Size([4644, 18])
2025-07-23 21:41:14,517 - INFO - 测试集特征形状 (Tensor): torch.Size([2064, 18])
2025-07-23 21:41:14,517 - INFO - 训练集目标形状 (Tensor): torch.Size([13932, 1])
2025-07-23 21:41:14,517 - INFO - 验证集目标形状 (Tensor): torch.Size([4644, 1])
2025-07-23 21:41:14,517 - INFO - 测试集目标形状 (Tensor): torch.Size([2064, 1])
2025-07-23 21:41:14,518 - INFO - 训练数据加载器包含 218 个批次。
2025-07-23 21:41:14,518 - INFO - 验证数据加载器包含 73 个批次。
2025-07-23 21:41:14,518 - INFO - 测试数据加载器包含 33 个批次。
2025-07-23 21:41:14,518 - INFO - 
--- 阶段2: 超参数优化 (Optuna) ---
2025-07-23 21:41:14,518 - INFO - 
--- 开始 Optuna 超参数优化 (共 10 次试验) ---
2025-07-23 21:41:17,115 - INFO - Trial 0: 选择了 FT-Transformer 模型
2025-07-23 21:41:19,489 - INFO - 
--- 模型训练开始 ---
2025-07-23 21:41:52,598 - INFO - Epoch [1/200], 训练损失: 0.4468, 验证损失: 0.3237, 验证 R2 (标准化): 0.6630
2025-07-23 21:42:23,564 - INFO - Epoch [2/200], 训练损失: 0.2861, 验证损失: 0.3022, 验证 R2 (标准化): 0.6854
2025-07-23 21:42:54,719 - INFO - Epoch [3/200], 训练损失: 0.2550, 验证损失: 0.2400, 验证 R2 (标准化): 0.7502
2025-07-23 21:43:25,778 - INFO - Epoch [4/200], 训练损失: 0.2351, 验证损失: 0.2493, 验证 R2 (标准化): 0.7405
2025-07-23 21:43:57,007 - INFO - Epoch [5/200], 训练损失: 0.2253, 验证损失: 0.2317, 验证 R2 (标准化): 0.7588
2025-07-23 21:44:28,415 - INFO - Epoch [6/200], 训练损失: 0.2154, 验证损失: 0.2284, 验证 R2 (标准化): 0.7622
2025-07-23 21:44:59,840 - INFO - Epoch [7/200], 训练损失: 0.2067, 验证损失: 0.2289, 验证 R2 (标准化): 0.7617
2025-07-23 21:45:31,612 - INFO - Epoch [8/200], 训练损失: 0.2002, 验证损失: 0.2059, 验证 R2 (标准化): 0.7856
2025-07-23 21:46:03,421 - INFO - Epoch [9/200], 训练损失: 0.1966, 验证损失: 0.2002, 验证 R2 (标准化): 0.7916
2025-07-23 21:46:35,897 - INFO - Epoch [10/200], 训练损失: 0.1896, 验证损失: 0.2047, 验证 R2 (标准化): 0.7868
2025-07-23 21:47:08,043 - INFO - Epoch [11/200], 训练损失: 0.1855, 验证损失: 0.2113, 验证 R2 (标准化): 0.7799
2025-07-23 21:47:40,042 - INFO - Epoch [12/200], 训练损失: 0.1815, 验证损失: 0.1882, 验证 R2 (标准化): 0.8041
2025-07-23 21:48:12,185 - INFO - Epoch [13/200], 训练损失: 0.1780, 验证损失: 0.2200, 验证 R2 (标准化): 0.7709
2025-07-23 21:48:44,276 - INFO - Epoch [14/200], 训练损失: 0.1733, 验证损失: 0.2161, 验证 R2 (标准化): 0.7750
2025-07-23 21:49:16,370 - INFO - Epoch [15/200], 训练损失: 0.1700, 验证损失: 0.2198, 验证 R2 (标准化): 0.7712
2025-07-23 21:49:48,791 - INFO - Epoch [16/200], 训练损失: 0.1663, 验证损失: 0.1848, 验证 R2 (标准化): 0.8076
2025-07-23 21:50:21,086 - INFO - Epoch [17/200], 训练损失: 0.1615, 验证损失: 0.1890, 验证 R2 (标准化): 0.8032
2025-07-23 21:50:53,064 - INFO - Epoch [18/200], 训练损失: 0.1563, 验证损失: 0.1895, 验证 R2 (标准化): 0.8027
2025-07-23 21:51:24,992 - INFO - Epoch [19/200], 训练损失: 0.1552, 验证损失: 0.1764, 验证 R2 (标准化): 0.8164
2025-07-23 21:51:56,890 - INFO - Epoch [20/200], 训练损失: 0.1512, 验证损失: 0.2029, 验证 R2 (标准化): 0.7887
2025-07-23 21:52:28,928 - INFO - Epoch [21/200], 训练损失: 0.1478, 验证损失: 0.1754, 验证 R2 (标准化): 0.8174
2025-07-23 21:53:00,980 - INFO - Epoch [22/200], 训练损失: 0.1432, 验证损失: 0.2087, 验证 R2 (标准化): 0.7827
2025-07-23 21:53:32,957 - INFO - Epoch [23/200], 训练损失: 0.1393, 验证损失: 0.1765, 验证 R2 (标准化): 0.8162
2025-07-23 21:54:04,867 - INFO - Epoch [24/200], 训练损失: 0.1366, 验证损失: 0.1931, 验证 R2 (标准化): 0.7989
2025-07-23 21:54:36,812 - INFO - Epoch [25/200], 训练损失: 0.1327, 验证损失: 0.1912, 验证 R2 (标准化): 0.8009
2025-07-23 21:55:08,743 - INFO - Epoch [26/200], 训练损失: 0.1299, 验证损失: 0.1817, 验证 R2 (标准化): 0.8108
2025-07-23 21:55:40,774 - INFO - Epoch [27/200], 训练损失: 0.1265, 验证损失: 0.1790, 验证 R2 (标准化): 0.8137
2025-07-23 21:56:12,842 - INFO - Epoch [28/200], 训练损失: 0.1218, 验证损失: 0.1763, 验证 R2 (标准化): 0.8164
2025-07-23 21:56:44,712 - INFO - Epoch [29/200], 训练损失: 0.1185, 验证损失: 0.1749, 验证 R2 (标准化): 0.8179
2025-07-23 21:57:16,735 - INFO - Epoch [30/200], 训练损失: 0.1161, 验证损失: 0.1820, 验证 R2 (标准化): 0.8106
2025-07-23 21:57:48,723 - INFO - Epoch [31/200], 训练损失: 0.1118, 验证损失: 0.1858, 验证 R2 (标准化): 0.8065
2025-07-23 21:58:20,761 - INFO - Epoch [32/200], 训练损失: 0.1096, 验证损失: 0.1943, 验证 R2 (标准化): 0.7977
2025-07-23 21:58:53,198 - INFO - Epoch [33/200], 训练损失: 0.1079, 验证损失: 0.1741, 验证 R2 (标准化): 0.8187
2025-07-23 21:59:25,387 - INFO - Epoch [34/200], 训练损失: 0.1039, 验证损失: 0.1891, 验证 R2 (标准化): 0.8031
2025-07-23 21:59:57,532 - INFO - Epoch [35/200], 训练损失: 0.1007, 验证损失: 0.1801, 验证 R2 (标准化): 0.8125
2025-07-23 22:00:29,546 - INFO - Epoch [36/200], 训练损失: 0.0974, 验证损失: 0.1876, 验证 R2 (标准化): 0.8047
2025-07-23 22:01:01,839 - INFO - Epoch [37/200], 训练损失: 0.0949, 验证损失: 0.1803, 验证 R2 (标准化): 0.8122
2025-07-23 22:01:33,864 - INFO - Epoch [38/200], 训练损失: 0.0938, 验证损失: 0.1807, 验证 R2 (标准化): 0.8119
2025-07-23 22:02:06,083 - INFO - Epoch [39/200], 训练损失: 0.0895, 验证损失: 0.1799, 验证 R2 (标准化): 0.8127
2025-07-23 22:02:38,396 - INFO - Epoch [40/200], 训练损失: 0.0859, 验证损失: 0.1815, 验证 R2 (标准化): 0.8110
2025-07-23 22:03:10,797 - INFO - Epoch [41/200], 训练损失: 0.0848, 验证损失: 0.1783, 验证 R2 (标准化): 0.8144
2025-07-23 22:03:43,003 - INFO - Epoch [42/200], 训练损失: 0.0650, 验证损失: 0.1721, 验证 R2 (标准化): 0.8208
2025-07-23 22:04:15,085 - INFO - Epoch [43/200], 训练损失: 0.0618, 验证损失: 0.1738, 验证 R2 (标准化): 0.8190
2025-07-23 22:04:47,102 - INFO - Epoch [44/200], 训练损失: 0.0599, 验证损失: 0.1740, 验证 R2 (标准化): 0.8188
2025-07-23 22:05:19,177 - INFO - Epoch [45/200], 训练损失: 0.0585, 验证损失: 0.1755, 验证 R2 (标准化): 0.8172
2025-07-23 22:05:51,457 - INFO - Epoch [46/200], 训练损失: 0.0565, 验证损失: 0.1761, 验证 R2 (标准化): 0.8167
2025-07-23 22:06:23,732 - INFO - Epoch [47/200], 训练损失: 0.0555, 验证损失: 0.1757, 验证 R2 (标准化): 0.8171
2025-07-23 22:06:55,799 - INFO - Epoch [48/200], 训练损失: 0.0533, 验证损失: 0.1774, 验证 R2 (标准化): 0.8153
2025-07-23 22:07:29,301 - INFO - Epoch [49/200], 训练损失: 0.0525, 验证损失: 0.1728, 验证 R2 (标准化): 0.8200
2025-07-23 22:08:02,175 - INFO - Epoch [50/200], 训练损失: 0.0509, 验证损失: 0.1752, 验证 R2 (标准化): 0.8176
2025-07-23 22:08:35,664 - INFO - Epoch [51/200], 训练损失: 0.0456, 验证损失: 0.1742, 验证 R2 (标准化): 0.8186
2025-07-23 22:09:08,638 - INFO - Epoch [52/200], 训练损失: 0.0448, 验证损失: 0.1745, 验证 R2 (标准化): 0.8183
2025-07-23 22:09:42,299 - INFO - Epoch [53/200], 训练损失: 0.0443, 验证损失: 0.1744, 验证 R2 (标准化): 0.8184
2025-07-23 22:10:15,840 - INFO - Epoch [54/200], 训练损失: 0.0438, 验证损失: 0.1754, 验证 R2 (标准化): 0.8174
2025-07-23 22:10:48,532 - INFO - Epoch [55/200], 训练损失: 0.0434, 验证损失: 0.1752, 验证 R2 (标准化): 0.8176
2025-07-23 22:11:21,017 - INFO - Epoch [56/200], 训练损失: 0.0429, 验证损失: 0.1748, 验证 R2 (标准化): 0.8180
2025-07-23 22:11:53,937 - INFO - Epoch [57/200], 训练损失: 0.0424, 验证损失: 0.1752, 验证 R2 (标准化): 0.8176
2025-07-23 22:11:53,938 - INFO - 早停！验证损失在 15 个epoch内没有显著改善。
2025-07-23 22:11:53,943 - INFO - --- 模型训练完成 ---
2025-07-23 22:11:54,158 - INFO - 图表已保存到: logs\训练与验证损失曲线.png
2025-07-23 22:11:58,116 - INFO - 图表已保存到: logs\验证集R2分数曲线.png
2025-07-23 22:12:04,129 - INFO - Trial 1: 选择了 FT-Transformer 模型
2025-07-23 22:12:04,130 - INFO - 
--- 模型训练开始 ---
2025-07-23 22:12:31,308 - INFO - Epoch [1/200], 训练损失: 0.3665, 验证损失: 0.2958, 验证 R2 (标准化): 0.6920
2025-07-23 22:12:58,297 - INFO - Epoch [2/200], 训练损失: 0.2451, 验证损失: 0.2363, 验证 R2 (标准化): 0.7540
2025-07-23 22:13:25,409 - INFO - Epoch [3/200], 训练损失: 0.2300, 验证损失: 0.2202, 验证 R2 (标准化): 0.7708
2025-07-23 22:13:52,382 - INFO - Epoch [4/200], 训练损失: 0.2179, 验证损失: 0.2257, 验证 R2 (标准化): 0.7650
2025-07-23 22:14:19,397 - INFO - Epoch [5/200], 训练损失: 0.2114, 验证损失: 0.2153, 验证 R2 (标准化): 0.7758
2025-07-23 22:14:46,400 - INFO - Epoch [6/200], 训练损失: 0.2033, 验证损失: 0.2071, 验证 R2 (标准化): 0.7843
2025-07-23 22:15:13,427 - INFO - Epoch [7/200], 训练损失: 0.1918, 验证损失: 0.1977, 验证 R2 (标准化): 0.7942
2025-07-23 22:15:40,309 - INFO - Epoch [8/200], 训练损失: 0.1884, 验证损失: 0.2065, 验证 R2 (标准化): 0.7850
2025-07-23 22:16:07,239 - INFO - Epoch [9/200], 训练损失: 0.1851, 验证损失: 0.1980, 验证 R2 (标准化): 0.7938
2025-07-23 22:16:33,931 - INFO - Epoch [10/200], 训练损失: 0.1800, 验证损失: 0.2004, 验证 R2 (标准化): 0.7914
2025-07-23 22:17:00,946 - INFO - Epoch [11/200], 训练损失: 0.1752, 验证损失: 0.1935, 验证 R2 (标准化): 0.7985
2025-07-23 22:17:27,908 - INFO - Epoch [12/200], 训练损失: 0.1686, 验证损失: 0.1913, 验证 R2 (标准化): 0.8008
2025-07-23 22:17:54,986 - INFO - Epoch [13/200], 训练损失: 0.1645, 验证损失: 0.1968, 验证 R2 (标准化): 0.7951
2025-07-23 22:18:22,125 - INFO - Epoch [14/200], 训练损失: 0.1619, 验证损失: 0.1880, 验证 R2 (标准化): 0.8043
2025-07-23 22:18:49,109 - INFO - Epoch [15/200], 训练损失: 0.1562, 验证损失: 0.1996, 验证 R2 (标准化): 0.7921
2025-07-23 22:19:16,093 - INFO - Epoch [16/200], 训练损失: 0.1545, 验证损失: 0.1830, 验证 R2 (标准化): 0.8094
2025-07-23 22:19:43,073 - INFO - Epoch [17/200], 训练损失: 0.1476, 验证损失: 0.1988, 验证 R2 (标准化): 0.7930
2025-07-23 22:20:10,154 - INFO - Epoch [18/200], 训练损失: 0.1422, 验证损失: 0.1915, 验证 R2 (标准化): 0.8006
2025-07-23 22:20:37,243 - INFO - Epoch [19/200], 训练损失: 0.1393, 验证损失: 0.1924, 验证 R2 (标准化): 0.7997
2025-07-23 22:21:04,254 - INFO - Epoch [20/200], 训练损失: 0.1341, 验证损失: 0.1908, 验证 R2 (标准化): 0.8014
2025-07-23 22:21:31,236 - INFO - Epoch [21/200], 训练损失: 0.1248, 验证损失: 0.1948, 验证 R2 (标准化): 0.7971
2025-07-23 22:21:58,346 - INFO - Epoch [22/200], 训练损失: 0.1209, 验证损失: 0.1927, 验证 R2 (标准化): 0.7993
2025-07-23 22:22:25,399 - INFO - Epoch [23/200], 训练损失: 0.1221, 验证损失: 0.1896, 验证 R2 (标准化): 0.8026
2025-07-23 22:22:52,600 - INFO - Epoch [24/200], 训练损失: 0.1150, 验证损失: 0.1859, 验证 R2 (标准化): 0.8064
2025-07-23 22:23:19,506 - INFO - Epoch [25/200], 训练损失: 0.0901, 验证损失: 0.1844, 验证 R2 (标准化): 0.8080
2025-07-23 22:23:46,729 - INFO - Epoch [26/200], 训练损失: 0.0816, 验证损失: 0.1841, 验证 R2 (标准化): 0.8083
2025-07-23 22:24:13,938 - INFO - Epoch [27/200], 训练损失: 0.0772, 验证损失: 0.1857, 验证 R2 (标准化): 0.8067
2025-07-23 22:24:41,338 - INFO - Epoch [28/200], 训练损失: 0.0741, 验证损失: 0.1862, 验证 R2 (标准化): 0.8062
2025-07-23 22:25:08,484 - INFO - Epoch [29/200], 训练损失: 0.0712, 验证损失: 0.1898, 验证 R2 (标准化): 0.8024
2025-07-23 22:25:35,119 - INFO - Epoch [30/200], 训练损失: 0.0678, 验证损失: 0.1875, 验证 R2 (标准化): 0.8048
2025-07-23 22:26:01,995 - INFO - Epoch [31/200], 训练损失: 0.0645, 验证损失: 0.1862, 验证 R2 (标准化): 0.8062
2025-07-23 22:26:01,996 - INFO - 早停！验证损失在 15 个epoch内没有显著改善。
2025-07-23 22:26:01,998 - INFO - --- 模型训练完成 ---
2025-07-23 22:26:02,192 - INFO - 图表已保存到: logs\训练与验证损失曲线.png
2025-07-23 22:26:04,195 - INFO - 图表已保存到: logs\验证集R2分数曲线.png
2025-07-23 22:26:08,655 - INFO - Trial 2: 选择了 FT-Transformer 模型
2025-07-23 22:26:08,656 - INFO - 
--- 模型训练开始 ---
2025-07-23 22:27:05,146 - INFO - Epoch [1/200], 训练损失: 0.4160, 验证损失: 0.3268, 验证 R2 (标准化): 0.6598
2025-07-23 22:27:59,626 - INFO - Epoch [2/200], 训练损失: 0.2694, 验证损失: 0.2547, 验证 R2 (标准化): 0.7349
2025-07-23 22:28:54,361 - INFO - Epoch [3/200], 训练损失: 0.2452, 验证损失: 0.2454, 验证 R2 (标准化): 0.7445
2025-07-23 22:29:48,824 - INFO - Epoch [4/200], 训练损失: 0.2280, 验证损失: 0.2434, 验证 R2 (标准化): 0.7466
