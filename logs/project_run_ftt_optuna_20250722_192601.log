2025-07-22 19:26:01,330 - INFO - --- 机器学习房屋价格预测项目 (深度学习版) - 集成FT-Transformer和Optuna启动 ---
2025-07-22 19:26:01,333 - INFO - 已设置随机种子为: 42
2025-07-22 19:26:01,333 - INFO - 
--- Phase 1: Data Acquisition, Exploration, and Preprocessing ---
2025-07-22 19:26:01,357 - INFO - 数据从 './data/california_housing.csv' 加载成功！
2025-07-22 19:26:01,357 - INFO - 
--- 数据概览 ---
2025-07-22 19:26:01,357 - INFO - 数据前5行:
2025-07-22 19:26:01,358 - INFO -    MedInc  HouseAge  AveRooms  AveBedrms  Population  AveOccup  Latitude  Longitude  MedHouseVal  target
0  8.3252      41.0  6.984127   1.023810       322.0  2.555556     37.88    -122.23        4.526   4.526
1  8.3014      21.0  6.238137   0.971880      2401.0  2.109842     37.86    -122.22        3.585   3.585
2  7.2574      52.0  8.288136   1.073446       496.0  2.802260     37.85    -122.24        3.521   3.521
3  5.6431      52.0  5.817352   1.073059       558.0  2.547945     37.85    -122.25        3.413   3.413
4  3.8462      52.0  6.281853   1.081081       565.0  2.181467     37.85    -122.25        3.422   3.422
2025-07-22 19:26:01,371 - INFO - 
数据基本信息:
2025-07-22 19:26:01,377 - INFO - <class 'pandas.core.frame.DataFrame'>
RangeIndex: 20640 entries, 0 to 20639
Data columns (total 10 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   MedInc       20640 non-null  float64
 1   HouseAge     20640 non-null  float64
 2   AveRooms     20640 non-null  float64
 3   AveBedrms    20640 non-null  float64
 4   Population   20640 non-null  float64
 5   AveOccup     20640 non-null  float64
 6   Latitude     20640 non-null  float64
 7   Longitude    20640 non-null  float64
 8   MedHouseVal  20640 non-null  float64
 9   target       20640 non-null  float64
dtypes: float64(10)
memory usage: 1.6 MB

2025-07-22 19:26:01,377 - INFO - 
描述性统计:
2025-07-22 19:26:01,392 - INFO -              MedInc      HouseAge      AveRooms     AveBedrms    Population      AveOccup      Latitude     Longitude   MedHouseVal        target
count  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000
mean       3.870671     28.639486      5.429000      1.096675   1425.476744      3.070655     35.631861   -119.569704      2.068558      2.068558
std        1.899822     12.585558      2.474173      0.473911   1132.462122     10.386050      2.135952      2.003532      1.153956      1.153956
min        0.499900      1.000000      0.846154      0.333333      3.000000      0.692308     32.540000   -124.350000      0.149990      0.149990
25%        2.563400     18.000000      4.440716      1.006079    787.000000      2.429741     33.930000   -121.800000      1.196000      1.196000
50%        3.534800     29.000000      5.229129      1.048780   1166.000000      2.818116     34.260000   -118.490000      1.797000      1.797000
75%        4.743250     37.000000      6.052381      1.099526   1725.000000      3.282261     37.710000   -118.010000      2.647250      2.647250
max       15.000100     52.000000    141.909091     34.066667  35682.000000   1243.333333     41.950000   -114.310000      5.000010      5.000010
2025-07-22 19:26:01,407 - INFO - 
缺失值检查:
2025-07-22 19:26:01,407 - INFO - MedInc         0
HouseAge       0
AveRooms       0
AveBedrms      0
Population     0
AveOccup       0
Latitude       0
Longitude      0
MedHouseVal    0
target         0
dtype: int64
2025-07-22 19:26:01,407 - INFO - 
数据初步探索完成。
2025-07-22 19:26:01,407 - INFO - 
--- 数据初步可视化 ---
2025-07-22 19:26:01,797 - INFO - 图表已保存到: logs\房屋价格分布.png
2025-07-22 19:26:05,595 - INFO - 图表已保存到: logs\特征与房价散点图.png
2025-07-22 19:26:08,586 - INFO - 
数据初步可视化完成。
2025-07-22 19:26:08,586 - INFO - 
--- 缺失值处理 ---
2025-07-22 19:26:08,587 - INFO - 数据集中没有发现缺失值。
2025-07-22 19:26:08,588 - INFO - 
--- 异常值处理 ---
2025-07-22 19:26:08,608 - INFO - 已使用 IQR 方法处理 5594 个异常值 (替换为边界值)。
2025-07-22 19:26:08,608 - INFO - 
--- 特征工程 ---
2025-07-22 19:26:08,612 - INFO - 已创建新特征 'Bedrms_Per_Room'。
2025-07-22 19:26:08,614 - INFO - 已创建新特征 'Population_Density'。
2025-07-22 19:26:08,615 - INFO - 已创建新特征 'Lat_x_Lon'。
2025-07-22 19:26:08,615 - INFO - 特征工程完成。
2025-07-22 19:26:08,615 - INFO - 
--- 数据划分与特征缩放 ---
2025-07-22 19:26:08,621 - INFO - 选择 StandardScaler 进行特征缩放。
2025-07-22 19:26:08,628 - INFO - 训练集特征形状: (16512, 12)
2025-07-22 19:26:08,629 - INFO - 测试集特征形状: (4128, 12)
2025-07-22 19:26:08,629 - INFO - 训练集目标形状: (16512,)
2025-07-22 19:26:08,629 - INFO - 测试集目标形状: (4128,)
2025-07-22 19:26:08,629 - INFO - 数据划分与特征缩放完成。
2025-07-22 19:26:08,630 - INFO - 
--- 数据划分与特征缩放 ---
2025-07-22 19:26:08,636 - INFO - 不进行特征缩放。
2025-07-22 19:26:08,636 - INFO - 训练集特征形状: (12384, 12)
2025-07-22 19:26:08,636 - INFO - 测试集特征形状: (4128, 12)
2025-07-22 19:26:08,636 - INFO - 训练集目标形状: (12384,)
2025-07-22 19:26:08,639 - INFO - 测试集目标形状: (4128,)
2025-07-22 19:26:08,639 - INFO - 数据划分与特征缩放完成。
2025-07-22 19:26:08,640 - INFO - Scaler saved to: ./models/scaler_ftt_optuna.pkl
2025-07-22 19:26:08,644 - INFO - 
Training set features shape (Tensor): torch.Size([12384, 12])
2025-07-22 19:26:08,644 - INFO - Validation set features shape (Tensor): torch.Size([4128, 12])
2025-07-22 19:26:08,646 - INFO - Test set features shape (Tensor): torch.Size([4128, 12])
2025-07-22 19:26:08,646 - INFO - Training set target shape (Tensor): torch.Size([12384, 1])
2025-07-22 19:26:08,646 - INFO - Validation set target shape (Tensor): torch.Size([4128, 1])
2025-07-22 19:26:08,646 - INFO - Test set target shape (Tensor): torch.Size([4128, 1])
2025-07-22 19:26:08,646 - INFO - Training data loader contains 194 batches.
2025-07-22 19:26:08,646 - INFO - Validation data loader contains 65 batches.
2025-07-22 19:26:08,646 - INFO - Test data loader contains 65 batches.
2025-07-22 19:26:08,646 - INFO - 
--- Phase 2: Hyperparameter Optimization (Optuna) ---
2025-07-22 19:26:08,646 - INFO - 
--- 开始 Optuna 超参数优化 (共 50 次试验) ---
2025-07-22 19:26:10,973 - INFO - Trial 0: 选择了 MLP 模型
2025-07-22 19:26:12,923 - INFO - 
--- 模型训练开始 ---
2025-07-22 19:26:15,576 - INFO - Epoch [1/100], 训练损失: 0.2462, 验证损失: 0.0737, 验证 R2: 0.9463
2025-07-22 19:26:17,195 - INFO - Epoch [2/100], 训练损失: 0.0056, 验证损失: 0.0017, 验证 R2: 0.9988
2025-07-22 19:26:18,802 - INFO - Epoch [3/100], 训练损失: 0.0016, 验证损失: 0.0020, 验证 R2: 0.9985
2025-07-22 19:26:20,409 - INFO - Epoch [4/100], 训练损失: 0.0015, 验证损失: 0.0023, 验证 R2: 0.9983
2025-07-22 19:26:22,018 - INFO - Epoch [5/100], 训练损失: 0.0015, 验证损失: 0.0019, 验证 R2: 0.9986
2025-07-22 19:26:23,758 - INFO - Epoch [6/100], 训练损失: 0.0014, 验证损失: 0.0014, 验证 R2: 0.9990
2025-07-22 19:26:25,369 - INFO - Epoch [7/100], 训练损失: 0.0016, 验证损失: 0.0011, 验证 R2: 0.9992
2025-07-22 19:26:26,953 - INFO - Epoch [8/100], 训练损失: 0.0015, 验证损失: 0.0012, 验证 R2: 0.9992
2025-07-22 19:26:28,739 - INFO - Epoch [9/100], 训练损失: 0.0012, 验证损失: 0.0028, 验证 R2: 0.9979
2025-07-22 19:26:30,724 - INFO - Epoch [10/100], 训练损失: 0.0058, 验证损失: 0.0079, 验证 R2: 0.9942
2025-07-22 19:26:32,281 - INFO - Epoch [11/100], 训练损失: 0.0022, 验证损失: 0.0011, 验证 R2: 0.9992
2025-07-22 19:26:34,003 - INFO - Epoch [12/100], 训练损失: 0.0016, 验证损失: 0.0050, 验证 R2: 0.9964
2025-07-22 19:26:35,645 - INFO - Epoch [13/100], 训练损失: 0.0020, 验证损失: 0.0019, 验证 R2: 0.9986
2025-07-22 19:26:37,604 - INFO - Epoch [14/100], 训练损失: 0.0009, 验证损失: 0.0008, 验证 R2: 0.9994
2025-07-22 19:26:39,186 - INFO - Epoch [15/100], 训练损失: 0.0010, 验证损失: 0.0009, 验证 R2: 0.9994
2025-07-22 19:26:40,777 - INFO - Epoch [16/100], 训练损失: 0.0008, 验证损失: 0.0010, 验证 R2: 0.9992
2025-07-22 19:26:42,369 - INFO - Epoch [17/100], 训练损失: 0.0008, 验证损失: 0.0025, 验证 R2: 0.9982
2025-07-22 19:26:43,969 - INFO - Epoch [18/100], 训练损失: 0.0058, 验证损失: 0.0008, 验证 R2: 0.9994
2025-07-22 19:26:45,587 - INFO - Epoch [19/100], 训练损失: 0.0013, 验证损失: 0.0008, 验证 R2: 0.9994
2025-07-22 19:26:47,328 - INFO - Epoch [20/100], 训练损失: 0.0015, 验证损失: 0.0006, 验证 R2: 0.9996
2025-07-22 19:26:48,950 - INFO - Epoch [21/100], 训练损失: 0.0007, 验证损失: 0.0007, 验证 R2: 0.9995
2025-07-22 19:26:50,556 - INFO - Epoch [22/100], 训练损失: 0.0016, 验证损失: 0.0020, 验证 R2: 0.9985
2025-07-22 19:26:52,112 - INFO - Epoch [23/100], 训练损失: 0.0010, 验证损失: 0.0016, 验证 R2: 0.9988
2025-07-22 19:26:53,654 - INFO - Epoch [24/100], 训练损失: 0.0011, 验证损失: 0.0005, 验证 R2: 0.9996
2025-07-22 19:26:55,234 - INFO - Epoch [25/100], 训练损失: 0.0009, 验证损失: 0.0006, 验证 R2: 0.9996
2025-07-22 19:26:56,838 - INFO - Epoch [26/100], 训练损失: 0.0016, 验证损失: 0.0008, 验证 R2: 0.9994
2025-07-22 19:26:58,387 - INFO - Epoch [27/100], 训练损失: 0.0017, 验证损失: 0.0015, 验证 R2: 0.9989
2025-07-22 19:26:59,999 - INFO - Epoch [28/100], 训练损失: 0.0008, 验证损失: 0.0022, 验证 R2: 0.9984
2025-07-22 19:27:01,574 - INFO - Epoch [29/100], 训练损失: 0.0008, 验证损失: 0.0006, 验证 R2: 0.9995
2025-07-22 19:27:03,120 - INFO - Epoch [30/100], 训练损失: 0.0008, 验证损失: 0.0025, 验证 R2: 0.9982
2025-07-22 19:27:04,712 - INFO - Epoch [31/100], 训练损失: 0.0004, 验证损失: 0.0003, 验证 R2: 0.9998
2025-07-22 19:27:06,314 - INFO - Epoch [32/100], 训练损失: 0.0002, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:27:07,913 - INFO - Epoch [33/100], 训练损失: 0.0003, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:27:09,493 - INFO - Epoch [34/100], 训练损失: 0.0003, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:27:11,072 - INFO - Epoch [35/100], 训练损失: 0.0003, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:27:12,690 - INFO - Epoch [36/100], 训练损失: 0.0003, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:27:14,312 - INFO - Epoch [37/100], 训练损失: 0.0004, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:27:15,874 - INFO - Epoch [38/100], 训练损失: 0.0002, 验证损失: 0.0003, 验证 R2: 0.9998
2025-07-22 19:27:17,449 - INFO - Epoch [39/100], 训练损失: 0.0002, 验证损失: 0.0003, 验证 R2: 0.9998
2025-07-22 19:27:19,191 - INFO - Epoch [40/100], 训练损失: 0.0002, 验证损失: 0.0003, 验证 R2: 0.9998
2025-07-22 19:27:20,974 - INFO - Epoch [41/100], 训练损失: 0.0002, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:27:22,630 - INFO - Epoch [42/100], 训练损失: 0.0002, 验证损失: 0.0006, 验证 R2: 0.9996
2025-07-22 19:27:24,280 - INFO - Epoch [43/100], 训练损失: 0.0002, 验证损失: 0.0003, 验证 R2: 0.9998
2025-07-22 19:27:25,943 - INFO - Epoch [44/100], 训练损失: 0.0002, 验证损失: 0.0003, 验证 R2: 0.9998
2025-07-22 19:27:27,661 - INFO - Epoch [45/100], 训练损失: 0.0002, 验证损失: 0.0006, 验证 R2: 0.9996
2025-07-22 19:27:29,333 - INFO - Epoch [46/100], 训练损失: 0.0002, 验证损失: 0.0004, 验证 R2: 0.9997
2025-07-22 19:27:31,025 - INFO - Epoch [47/100], 训练损失: 0.0002, 验证损失: 0.0008, 验证 R2: 0.9994
2025-07-22 19:27:32,655 - INFO - Epoch [48/100], 训练损失: 0.0003, 验证损失: 0.0003, 验证 R2: 0.9998
2025-07-22 19:27:32,655 - INFO - 早停！验证损失在 10 个epoch内没有显著改善。
2025-07-22 19:27:32,656 - INFO - --- 模型训练完成 ---
2025-07-22 19:27:32,810 - INFO - 图表已保存到: logs\训练与验证损失曲线.png
2025-07-22 19:27:34,940 - INFO - 图表已保存到: logs\验证集R2分数曲线.png
2025-07-22 19:27:36,363 - INFO - Trial 1: 选择了 FT-Transformer 模型
2025-07-22 19:27:36,363 - INFO - 
--- 模型训练开始 ---
