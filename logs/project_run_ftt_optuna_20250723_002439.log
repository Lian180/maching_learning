2025-07-23 00:24:39,016 - INFO - --- 机器学习房屋价格预测项目 (深度学习版) - 集成FT-Transformer和Optuna启动 ---
2025-07-23 00:24:39,020 - INFO - 已设置随机种子为: 42
2025-07-23 00:24:39,020 - INFO - 
--- 阶段1: 数据获取、探索与预处理 ---
2025-07-23 00:24:39,042 - INFO - 数据从 './data/california_housing.csv' 加载成功！
2025-07-23 00:24:39,043 - INFO - 
--- 数据概览 ---
2025-07-23 00:24:39,043 - INFO - 数据前5行:
2025-07-23 00:24:39,043 - INFO -    MedInc  HouseAge  AveRooms  AveBedrms  ...  AveOccup  Latitude  Longitude  target
0  8.3252        41  6.984127   1.023810  ...  2.555556     37.88    -122.23   4.526
1  8.3014        21  6.238137   0.971880  ...  2.109842     37.86    -122.22   3.585
2  7.2574        52  8.288136   1.073446  ...  2.802260     37.85    -122.24   3.521
3  5.6431        52  5.817352   1.073059  ...  2.547945     37.85    -122.25   3.413
4  3.8462        52  6.281853   1.081081  ...  2.181467     37.85    -122.25   3.422

[5 rows x 9 columns]
2025-07-23 00:24:39,065 - INFO - 
数据基本信息:
2025-07-23 00:24:39,068 - INFO - <class 'pandas.core.frame.DataFrame'>
RangeIndex: 20640 entries, 0 to 20639
Data columns (total 9 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   MedInc      20640 non-null  float64
 1   HouseAge    20640 non-null  int64  
 2   AveRooms    20640 non-null  float64
 3   AveBedrms   20640 non-null  float64
 4   Population  20640 non-null  int64  
 5   AveOccup    20640 non-null  float64
 6   Latitude    20640 non-null  float64
 7   Longitude   20640 non-null  float64
 8   target      20640 non-null  float64
dtypes: float64(7), int64(2)
memory usage: 1.4 MB

2025-07-23 00:24:39,068 - INFO - 
描述性统计:
2025-07-23 00:24:39,079 - INFO -              MedInc      HouseAge  ...     Longitude        target
count  20640.000000  20640.000000  ...  20640.000000  20640.000000
mean       3.870671     28.639486  ...   -119.569704      2.068558
std        1.899822     12.585558  ...      2.003532      1.153956
min        0.499900      1.000000  ...   -124.350000      0.149990
25%        2.563400     18.000000  ...   -121.800000      1.196000
50%        3.534800     29.000000  ...   -118.490000      1.797000
75%        4.743250     37.000000  ...   -118.010000      2.647250
max       15.000100     52.000000  ...   -114.310000      5.000010

[8 rows x 9 columns]
2025-07-23 00:24:39,091 - INFO - 
缺失值检查:
2025-07-23 00:24:39,091 - INFO - MedInc        0
HouseAge      0
AveRooms      0
AveBedrms     0
Population    0
AveOccup      0
Latitude      0
Longitude     0
target        0
dtype: int64
2025-07-23 00:24:39,092 - INFO - 
数据初步探索完成。
2025-07-23 00:24:39,092 - INFO - 
--- 数据初步可视化 ---
2025-07-23 00:24:39,474 - INFO - 图表已保存到: logs\房屋价格分布.png
2025-07-23 00:24:43,001 - INFO - 图表已保存到: logs\特征与房价散点图.png
2025-07-23 00:24:46,033 - INFO - 
数据初步可视化完成。
2025-07-23 00:24:46,033 - INFO - 
--- 缺失值处理 ---
2025-07-23 00:24:46,034 - INFO - 数据集中没有发现缺失值。
2025-07-23 00:24:46,034 - INFO - 
--- 异常值处理 ---
2025-07-23 00:24:46,052 - INFO - 已使用 IQR 方法处理 4523 个异常值 (替换为边界值)。
2025-07-23 00:24:46,052 - INFO - 
--- 特征工程 ---
2025-07-23 00:24:46,054 - INFO - 已创建新特征 'Bedrms_Per_Room'。
2025-07-23 00:24:46,056 - INFO - 已创建新特征 'Population_Density'。
2025-07-23 00:24:46,056 - INFO - 已创建新特征 'Lat_x_Lon'。
2025-07-23 00:24:46,056 - INFO - 特征工程完成。
2025-07-23 00:24:46,056 - INFO - 
--- 数据划分与特征缩放 ---
2025-07-23 00:24:46,062 - INFO - 选择 StandardScaler 进行特征缩放。
2025-07-23 00:24:46,070 - INFO - 目标变量已使用 StandardScaler 进行缩放。
2025-07-23 00:24:46,070 - INFO - 训练集特征形状: (16512, 11)
2025-07-23 00:24:46,070 - INFO - 测试集特征形状: (4128, 11)
2025-07-23 00:24:46,070 - INFO - 训练集目标形状: (16512,)
2025-07-23 00:24:46,070 - INFO - 测试集目标形状: (4128,)
2025-07-23 00:24:46,070 - INFO - 数据划分与特征缩放完成。
2025-07-23 00:24:46,075 - INFO - 特征标准化器已保存到: ./models/scaler_ftt_optuna.pkl
2025-07-23 00:24:46,075 - INFO - 目标标准化器已保存到: ./models/target_scaler_ftt_optuna.pkl
2025-07-23 00:24:46,079 - INFO - 
训练集特征形状 (Tensor): torch.Size([12384, 11])
2025-07-23 00:24:46,079 - INFO - 验证集特征形状 (Tensor): torch.Size([4128, 11])
2025-07-23 00:24:46,079 - INFO - 测试集特征形状 (Tensor): torch.Size([4128, 11])
2025-07-23 00:24:46,079 - INFO - 训练集目标形状 (Tensor): torch.Size([12384, 1])
2025-07-23 00:24:46,079 - INFO - 验证集目标形状 (Tensor): torch.Size([4128, 1])
2025-07-23 00:24:46,079 - INFO - 测试集目标形状 (Tensor): torch.Size([4128, 1])
2025-07-23 00:24:46,079 - INFO - 训练数据加载器包含 194 个批次。
2025-07-23 00:24:46,079 - INFO - 验证数据加载器包含 65 个批次。
2025-07-23 00:24:46,079 - INFO - 测试数据加载器包含 65 个批次。
2025-07-23 00:24:46,079 - INFO - 
--- 阶段2: 超参数优化 (Optuna) ---
2025-07-23 00:24:46,080 - INFO - 
--- 开始 Optuna 超参数优化 (共 50 次试验) ---
2025-07-23 00:24:50,650 - INFO - Trial 0: 选择了 MLP 模型
2025-07-23 00:24:52,994 - INFO - 
--- 模型训练开始 ---
2025-07-23 00:24:55,937 - INFO - Epoch [1/50], 训练损失: 0.3932, 验证损失: 0.2990, 验证 R2 (标准化): 0.7089
2025-07-23 00:24:56,650 - INFO - Epoch [2/50], 训练损失: 0.2627, 验证损失: 0.2569, 验证 R2 (标准化): 0.7499
2025-07-23 00:24:57,395 - INFO - Epoch [3/50], 训练损失: 0.2416, 验证损失: 0.2384, 验证 R2 (标准化): 0.7679
2025-07-23 00:24:58,101 - INFO - Epoch [4/50], 训练损失: 0.2273, 验证损失: 0.2419, 验证 R2 (标准化): 0.7645
2025-07-23 00:24:58,820 - INFO - Epoch [5/50], 训练损失: 0.2205, 验证损失: 0.2261, 验证 R2 (标准化): 0.7799
2025-07-23 00:24:59,545 - INFO - Epoch [6/50], 训练损失: 0.2104, 验证损失: 0.2647, 验证 R2 (标准化): 0.7423
2025-07-23 00:25:00,241 - INFO - Epoch [7/50], 训练损失: 0.2075, 验证损失: 0.2316, 验证 R2 (标准化): 0.7745
2025-07-23 00:25:00,983 - INFO - Epoch [8/50], 训练损失: 0.2042, 验证损失: 0.2186, 验证 R2 (标准化): 0.7872
2025-07-23 00:25:01,736 - INFO - Epoch [9/50], 训练损失: 0.1988, 验证损失: 0.2370, 验证 R2 (标准化): 0.7692
2025-07-23 00:25:02,458 - INFO - Epoch [10/50], 训练损失: 0.1955, 验证损失: 0.2191, 验证 R2 (标准化): 0.7867
2025-07-23 00:25:03,197 - INFO - Epoch [11/50], 训练损失: 0.1934, 验证损失: 0.2165, 验证 R2 (标准化): 0.7892
2025-07-23 00:25:03,932 - INFO - Epoch [12/50], 训练损失: 0.1878, 验证损失: 0.2163, 验证 R2 (标准化): 0.7894
2025-07-23 00:25:04,645 - INFO - Epoch [13/50], 训练损失: 0.1872, 验证损失: 0.2173, 验证 R2 (标准化): 0.7884
2025-07-23 00:25:05,361 - INFO - Epoch [14/50], 训练损失: 0.1837, 验证损失: 0.2184, 验证 R2 (标准化): 0.7874
2025-07-23 00:25:06,101 - INFO - Epoch [15/50], 训练损失: 0.1817, 验证损失: 0.2169, 验证 R2 (标准化): 0.7889
2025-07-23 00:25:06,811 - INFO - Epoch [16/50], 训练损失: 0.1797, 验证损失: 0.2219, 验证 R2 (标准化): 0.7840
2025-07-23 00:25:07,534 - INFO - Epoch [17/50], 训练损失: 0.1761, 验证损失: 0.2161, 验证 R2 (标准化): 0.7897
2025-07-23 00:25:08,277 - INFO - Epoch [18/50], 训练损失: 0.1758, 验证损失: 0.2030, 验证 R2 (标准化): 0.8024
2025-07-23 00:25:08,988 - INFO - Epoch [19/50], 训练损失: 0.1708, 验证损失: 0.2481, 验证 R2 (标准化): 0.7585
2025-07-23 00:25:09,709 - INFO - Epoch [20/50], 训练损失: 0.1695, 验证损失: 0.2240, 验证 R2 (标准化): 0.7819
2025-07-23 00:25:10,447 - INFO - Epoch [21/50], 训练损失: 0.1677, 验证损失: 0.2592, 验证 R2 (标准化): 0.7476
2025-07-23 00:25:11,148 - INFO - Epoch [22/50], 训练损失: 0.1645, 验证损失: 0.2168, 验证 R2 (标准化): 0.7890
2025-07-23 00:25:11,864 - INFO - Epoch [23/50], 训练损失: 0.1623, 验证损失: 0.2251, 验证 R2 (标准化): 0.7809
2025-07-23 00:25:12,601 - INFO - Epoch [24/50], 训练损失: 0.1613, 验证损失: 0.2409, 验证 R2 (标准化): 0.7655
2025-07-23 00:25:13,341 - INFO - Epoch [25/50], 训练损失: 0.1450, 验证损失: 0.2170, 验证 R2 (标准化): 0.7888
2025-07-23 00:25:14,101 - INFO - Epoch [26/50], 训练损失: 0.1402, 验证损失: 0.2150, 验证 R2 (标准化): 0.7906
2025-07-23 00:25:14,829 - INFO - Epoch [27/50], 训练损失: 0.1386, 验证损失: 0.2156, 验证 R2 (标准化): 0.7901
2025-07-23 00:25:15,553 - INFO - Epoch [28/50], 训练损失: 0.1361, 验证损失: 0.2200, 验证 R2 (标准化): 0.7859
2025-07-23 00:25:15,553 - INFO - 早停！验证损失在 10 个epoch内没有显著改善。
2025-07-23 00:25:15,554 - INFO - --- 模型训练完成 ---
2025-07-23 00:25:15,862 - INFO - 图表已保存到: logs\训练与验证损失曲线.png
2025-07-23 00:25:19,554 - INFO - 图表已保存到: logs\验证集R2分数曲线.png
2025-07-23 00:25:22,433 - INFO - Trial 1: 选择了 MLP 模型
2025-07-23 00:25:22,433 - INFO - 
--- 模型训练开始 ---
2025-07-23 00:25:24,520 - INFO - Epoch [1/50], 训练损失: 0.6487, 验证损失: 0.3702, 验证 R2 (标准化): 0.6396
2025-07-23 00:25:26,268 - INFO - Epoch [2/50], 训练损失: 0.2997, 验证损失: 0.2972, 验证 R2 (标准化): 0.7107
2025-07-23 00:25:28,089 - INFO - Epoch [3/50], 训练损失: 0.2721, 验证损失: 0.3048, 验证 R2 (标准化): 0.7033
2025-07-23 00:25:29,963 - INFO - Epoch [4/50], 训练损失: 0.2582, 验证损失: 0.2615, 验证 R2 (标准化): 0.7454
2025-07-23 00:25:32,040 - INFO - Epoch [5/50], 训练损失: 0.2433, 验证损失: 0.2316, 验证 R2 (标准化): 0.7745
2025-07-23 00:25:33,996 - INFO - Epoch [6/50], 训练损失: 0.2320, 验证损失: 0.2519, 验证 R2 (标准化): 0.7548
2025-07-23 00:25:35,827 - INFO - Epoch [7/50], 训练损失: 0.2182, 验证损失: 0.2320, 验证 R2 (标准化): 0.7742
2025-07-23 00:25:37,711 - INFO - Epoch [8/50], 训练损失: 0.2160, 验证损失: 0.2311, 验证 R2 (标准化): 0.7750
2025-07-23 00:25:39,581 - INFO - Epoch [9/50], 训练损失: 0.2060, 验证损失: 0.2309, 验证 R2 (标准化): 0.7752
2025-07-23 00:25:41,415 - INFO - Epoch [10/50], 训练损失: 0.2004, 验证损失: 0.2194, 验证 R2 (标准化): 0.7864
2025-07-23 00:25:43,256 - INFO - Epoch [11/50], 训练损失: 0.1935, 验证损失: 0.2195, 验证 R2 (标准化): 0.7863
2025-07-23 00:25:45,144 - INFO - Epoch [12/50], 训练损失: 0.1899, 验证损失: 0.2495, 验证 R2 (标准化): 0.7571
2025-07-23 00:25:47,111 - INFO - Epoch [13/50], 训练损失: 0.1848, 验证损失: 0.2133, 验证 R2 (标准化): 0.7924
2025-07-23 00:25:49,092 - INFO - Epoch [14/50], 训练损失: 0.1784, 验证损失: 0.2172, 验证 R2 (标准化): 0.7886
2025-07-23 00:25:51,045 - INFO - Epoch [15/50], 训练损失: 0.1750, 验证损失: 0.2439, 验证 R2 (标准化): 0.7626
2025-07-23 00:25:52,993 - INFO - Epoch [16/50], 训练损失: 0.1692, 验证损失: 0.2335, 验证 R2 (标准化): 0.7727
2025-07-23 00:25:54,921 - INFO - Epoch [17/50], 训练损失: 0.1641, 验证损失: 0.2145, 验证 R2 (标准化): 0.7912
2025-07-23 00:25:56,952 - INFO - Epoch [18/50], 训练损失: 0.1604, 验证损失: 0.2565, 验证 R2 (标准化): 0.7503
2025-07-23 00:25:58,930 - INFO - Epoch [19/50], 训练损失: 0.1572, 验证损失: 0.2333, 验证 R2 (标准化): 0.7729
2025-07-23 00:26:00,900 - INFO - Epoch [20/50], 训练损失: 0.1340, 验证损失: 0.2235, 验证 R2 (标准化): 0.7825
2025-07-23 00:26:02,822 - INFO - Epoch [21/50], 训练损失: 0.1247, 验证损失: 0.2271, 验证 R2 (标准化): 0.7789
2025-07-23 00:26:04,744 - INFO - Epoch [22/50], 训练损失: 0.1198, 验证损失: 0.2236, 验证 R2 (标准化): 0.7823
2025-07-23 00:26:06,673 - INFO - Epoch [23/50], 训练损失: 0.1144, 验证损失: 0.2229, 验证 R2 (标准化): 0.7830
2025-07-23 00:26:06,673 - INFO - 早停！验证损失在 10 个epoch内没有显著改善。
2025-07-23 00:26:06,677 - INFO - --- 模型训练完成 ---
2025-07-23 00:26:06,817 - INFO - 图表已保存到: logs\训练与验证损失曲线.png
2025-07-23 00:26:08,812 - INFO - 图表已保存到: logs\验证集R2分数曲线.png
2025-07-23 00:26:10,865 - INFO - Trial 2: 选择了 FT-Transformer 模型
2025-07-23 00:26:10,865 - INFO - 
--- 模型训练开始 ---
2025-07-23 00:26:14,113 - INFO - Epoch [1/50], 训练损失: 0.4195, 验证损失: 0.2964, 验证 R2 (标准化): 0.7115
2025-07-23 00:26:17,269 - INFO - Epoch [2/50], 训练损失: 0.2954, 验证损失: 0.2732, 验证 R2 (标准化): 0.7340
2025-07-23 00:26:20,400 - INFO - Epoch [3/50], 训练损失: 0.2625, 验证损失: 0.2581, 验证 R2 (标准化): 0.7488
2025-07-23 00:26:23,606 - INFO - Epoch [4/50], 训练损失: 0.2402, 验证损失: 0.2349, 验证 R2 (标准化): 0.7713
2025-07-23 00:26:26,903 - INFO - Epoch [5/50], 训练损失: 0.2303, 验证损失: 0.2546, 验证 R2 (标准化): 0.7521
2025-07-23 00:26:30,526 - INFO - Epoch [6/50], 训练损失: 0.2210, 验证损失: 0.2667, 验证 R2 (标准化): 0.7404
2025-07-23 00:26:33,713 - INFO - Epoch [7/50], 训练损失: 0.2148, 验证损失: 0.2227, 验证 R2 (标准化): 0.7832
2025-07-23 00:26:36,858 - INFO - Epoch [8/50], 训练损失: 0.2073, 验证损失: 0.3790, 验证 R2 (标准化): 0.6311
2025-07-23 00:26:40,116 - INFO - Epoch [9/50], 训练损失: 0.2010, 验证损失: 0.2400, 验证 R2 (标准化): 0.7663
2025-07-23 00:26:43,414 - INFO - Epoch [10/50], 训练损失: 0.1967, 验证损失: 0.2081, 验证 R2 (标准化): 0.7974
2025-07-23 00:26:46,637 - INFO - Epoch [11/50], 训练损失: 0.1888, 验证损失: 0.2058, 验证 R2 (标准化): 0.7996
2025-07-23 00:26:49,887 - INFO - Epoch [12/50], 训练损失: 0.1859, 验证损失: 0.2050, 验证 R2 (标准化): 0.8005
2025-07-23 00:26:52,993 - INFO - Epoch [13/50], 训练损失: 0.1819, 验证损失: 0.2331, 验证 R2 (标准化): 0.7730
2025-07-23 00:26:56,152 - INFO - Epoch [14/50], 训练损失: 0.1773, 验证损失: 0.2201, 验证 R2 (标准化): 0.7857
2025-07-23 00:26:59,350 - INFO - Epoch [15/50], 训练损失: 0.1740, 验证损失: 0.2362, 验证 R2 (标准化): 0.7701
2025-07-23 00:27:02,566 - INFO - Epoch [16/50], 训练损失: 0.1694, 验证损失: 0.1910, 验证 R2 (标准化): 0.8141
2025-07-23 00:27:05,771 - INFO - Epoch [17/50], 训练损失: 0.1656, 验证损失: 0.2517, 验证 R2 (标准化): 0.7550
2025-07-23 00:27:09,260 - INFO - Epoch [18/50], 训练损失: 0.1605, 验证损失: 0.2034, 验证 R2 (标准化): 0.8020
2025-07-23 00:27:12,546 - INFO - Epoch [19/50], 训练损失: 0.1576, 验证损失: 0.2064, 验证 R2 (标准化): 0.7991
2025-07-23 00:27:15,652 - INFO - Epoch [20/50], 训练损失: 0.1538, 验证损失: 0.2005, 验证 R2 (标准化): 0.8048
2025-07-23 00:27:18,869 - INFO - Epoch [21/50], 训练损失: 0.1511, 验证损失: 0.2172, 验证 R2 (标准化): 0.7886
2025-07-23 00:27:22,190 - INFO - Epoch [22/50], 训练损失: 0.1478, 验证损失: 0.2102, 验证 R2 (标准化): 0.7953
2025-07-23 00:27:25,500 - INFO - Epoch [23/50], 训练损失: 0.1292, 验证损失: 0.2051, 验证 R2 (标准化): 0.8003
2025-07-23 00:27:28,847 - INFO - Epoch [24/50], 训练损失: 0.1247, 验证损失: 0.1970, 验证 R2 (标准化): 0.8082
2025-07-23 00:27:32,124 - INFO - Epoch [25/50], 训练损失: 0.1209, 验证损失: 0.1894, 验证 R2 (标准化): 0.8156
