2025-07-23 14:29:46,026 - INFO - --- 机器学习房屋价格预测项目 (深度学习版) - 集成FT-Transformer和Optuna启动 ---
2025-07-23 14:29:46,031 - INFO - 已设置随机种子为: 42
2025-07-23 14:29:46,031 - INFO - 
--- 阶段1: 数据获取、探索与预处理 ---
2025-07-23 14:29:46,058 - INFO - 数据从 './data/california_housing.csv' 加载成功！
2025-07-23 14:29:46,059 - INFO - 
--- 数据概览 ---
2025-07-23 14:29:46,059 - INFO - 数据前5行:
2025-07-23 14:29:46,059 - INFO -    MedInc  HouseAge  AveRooms  AveBedrms  Population  AveOccup  Latitude  Longitude  target
0  8.3252        41  6.984127   1.023810         322  2.555556     37.88    -122.23   4.526
1  8.3014        21  6.238137   0.971880        2401  2.109842     37.86    -122.22   3.585
2  7.2574        52  8.288136   1.073446         496  2.802260     37.85    -122.24   3.521
3  5.6431        52  5.817352   1.073059         558  2.547945     37.85    -122.25   3.413
4  3.8462        52  6.281853   1.081081         565  2.181467     37.85    -122.25   3.422
2025-07-23 14:29:46,071 - INFO - 
数据基本信息:
2025-07-23 14:29:46,078 - INFO - <class 'pandas.core.frame.DataFrame'>
RangeIndex: 20640 entries, 0 to 20639
Data columns (total 9 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   MedInc      20640 non-null  float64
 1   HouseAge    20640 non-null  int64  
 2   AveRooms    20640 non-null  float64
 3   AveBedrms   20640 non-null  float64
 4   Population  20640 non-null  int64  
 5   AveOccup    20640 non-null  float64
 6   Latitude    20640 non-null  float64
 7   Longitude   20640 non-null  float64
 8   target      20640 non-null  float64
dtypes: float64(7), int64(2)
memory usage: 1.4 MB

2025-07-23 14:29:46,078 - INFO - 
描述性统计:
2025-07-23 14:29:46,090 - INFO -              MedInc      HouseAge      AveRooms     AveBedrms    Population      AveOccup      Latitude     Longitude        target
count  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000  20640.000000
mean       3.870671     28.639486      5.429000      1.096675   1425.476744      3.070655     35.631861   -119.569704      2.068558
std        1.899822     12.585558      2.474173      0.473911   1132.462122     10.386050      2.135952      2.003532      1.153956
min        0.499900      1.000000      0.846154      0.333333      3.000000      0.692308     32.540000   -124.350000      0.149990
25%        2.563400     18.000000      4.440716      1.006079    787.000000      2.429741     33.930000   -121.800000      1.196000
50%        3.534800     29.000000      5.229129      1.048780   1166.000000      2.818116     34.260000   -118.490000      1.797000
75%        4.743250     37.000000      6.052381      1.099526   1725.000000      3.282261     37.710000   -118.010000      2.647250
max       15.000100     52.000000    141.909091     34.066667  35682.000000   1243.333333     41.950000   -114.310000      5.000010
2025-07-23 14:29:46,094 - INFO - 
缺失值检查:
2025-07-23 14:29:46,094 - INFO - MedInc        0
HouseAge      0
AveRooms      0
AveBedrms     0
Population    0
AveOccup      0
Latitude      0
Longitude     0
target        0
dtype: int64
2025-07-23 14:29:46,094 - INFO - 
数据初步探索完成。
2025-07-23 14:29:46,104 - INFO - 
--- 数据初步可视化 ---
2025-07-23 14:29:46,613 - INFO - 图表已保存到: logs\房屋价格分布.png
2025-07-23 14:29:56,662 - INFO - 图表已保存到: logs\特征与房价散点图.png
2025-07-23 14:34:33,488 - INFO - 
数据初步可视化完成。
2025-07-23 14:34:33,489 - INFO - 
--- 缺失值处理 ---
2025-07-23 14:34:33,490 - INFO - 数据集中没有发现缺失值。
2025-07-23 14:34:33,490 - INFO - 
--- 异常值处理 ---
2025-07-23 14:34:33,507 - INFO - 已使用 IQR 方法处理 4523 个异常值 (替换为边界值)。
2025-07-23 14:34:33,507 - INFO - 
--- 特征工程 ---
2025-07-23 14:34:33,512 - INFO - 已创建新特征 'Bedrms_Per_Room'。
2025-07-23 14:34:33,518 - INFO - 已创建新特征 'Population_Density_Geo' (基于地理分桶)。
2025-07-23 14:34:33,518 - INFO - 已创建新特征 'Lat_x_Lon'。
2025-07-23 14:34:33,524 - INFO - 已创建经纬度多项式特征。
2025-07-23 14:34:33,525 - INFO - 已创建新特征 'HouseAge_sq' 和 'HouseAge_log'。
2025-07-23 14:34:33,526 - INFO - 已创建新特征 'MedInc_x_AveRooms'。
2025-07-23 14:34:33,526 - INFO - 已创建新特征 'Rooms_Per_Person'。
2025-07-23 14:34:33,527 - INFO - 特征工程完成。
2025-07-23 14:34:33,527 - INFO - 
--- 数据划分与特征缩放 ---
2025-07-23 14:34:33,536 - INFO - 选择 StandardScaler 进行特征缩放。
2025-07-23 14:34:33,546 - INFO - 目标变量已使用 StandardScaler 进行缩放。
2025-07-23 14:34:33,547 - INFO - 训练集特征形状: (18576, 18)
2025-07-23 14:34:33,547 - INFO - 测试集特征形状: (2064, 18)
2025-07-23 14:34:33,547 - INFO - 训练集目标形状: (18576,)
2025-07-23 14:34:33,547 - INFO - 测试集目标形状: (2064,)
2025-07-23 14:34:33,547 - INFO - 数据划分与特征缩放完成。
2025-07-23 14:34:33,553 - INFO - 特征标准化器已保存到: ./models/scaler_ftt_optuna.pkl
2025-07-23 14:34:33,553 - INFO - 目标标准化器已保存到: ./models/target_scaler_ftt_optuna.pkl
2025-07-23 14:34:33,556 - INFO - 
训练集特征形状 (Tensor): torch.Size([13932, 18])
2025-07-23 14:34:33,556 - INFO - 验证集特征形状 (Tensor): torch.Size([4644, 18])
2025-07-23 14:34:33,556 - INFO - 测试集特征形状 (Tensor): torch.Size([2064, 18])
2025-07-23 14:34:33,556 - INFO - 训练集目标形状 (Tensor): torch.Size([13932, 1])
2025-07-23 14:34:33,556 - INFO - 验证集目标形状 (Tensor): torch.Size([4644, 1])
2025-07-23 14:34:33,556 - INFO - 测试集目标形状 (Tensor): torch.Size([2064, 1])
2025-07-23 14:34:33,556 - INFO - 训练数据加载器包含 218 个批次。
2025-07-23 14:34:33,557 - INFO - 验证数据加载器包含 73 个批次。
2025-07-23 14:34:33,557 - INFO - 测试数据加载器包含 33 个批次。
2025-07-23 14:34:33,557 - INFO - 
--- 阶段2: 超参数优化 (Optuna) ---
2025-07-23 14:34:33,557 - INFO - 
--- 开始 Optuna 超参数优化 (共 50 次试验) ---
2025-07-23 14:34:35,962 - INFO - Trial 0: 选择了 FT-Transformer 模型
2025-07-23 14:34:38,539 - INFO - 
--- 模型训练开始 ---
2025-07-23 14:34:48,122 - INFO - Epoch [1/100], 训练损失: 1.0525, 验证损失: 0.9605, 验证 R2 (标准化): -0.0000
2025-07-23 14:34:56,406 - INFO - Epoch [2/100], 训练损失: 1.0138, 验证损失: 0.9618, 验证 R2 (标准化): -0.0014
2025-07-23 14:35:04,557 - INFO - Epoch [3/100], 训练损失: 1.0134, 验证损失: 0.9607, 验证 R2 (标准化): -0.0002
2025-07-23 14:35:12,769 - INFO - Epoch [4/100], 训练损失: 1.0137, 验证损失: 0.9610, 验证 R2 (标准化): -0.0006
2025-07-23 14:35:20,956 - INFO - Epoch [5/100], 训练损失: 1.0134, 验证损失: 0.9606, 验证 R2 (标准化): -0.0001
2025-07-23 14:35:29,183 - INFO - Epoch [6/100], 训练损失: 1.0142, 验证损失: 0.9608, 验证 R2 (标准化): -0.0004
2025-07-23 14:35:37,348 - INFO - Epoch [7/100], 训练损失: 1.0134, 验证损失: 0.9612, 验证 R2 (标准化): -0.0008
2025-07-23 14:35:45,543 - INFO - Epoch [8/100], 训练损失: 1.0135, 验证损失: 1.0156, 验证 R2 (标准化): -0.0574
2025-07-23 14:35:53,730 - INFO - Epoch [9/100], 训练损失: 1.0131, 验证损失: 0.9620, 验证 R2 (标准化): -0.0017
2025-07-23 14:36:01,929 - INFO - Epoch [10/100], 训练损失: 1.0133, 验证损失: 0.9607, 验证 R2 (标准化): -0.0002
2025-07-23 14:36:10,096 - INFO - Epoch [11/100], 训练损失: 1.0133, 验证损失: 0.9608, 验证 R2 (标准化): -0.0003
2025-07-23 14:36:18,247 - INFO - Epoch [12/100], 训练损失: 1.0133, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:36:26,413 - INFO - Epoch [13/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:36:34,501 - INFO - Epoch [14/100], 训练损失: 1.0132, 验证损失: 0.9607, 验证 R2 (标准化): -0.0003
2025-07-23 14:36:42,525 - INFO - Epoch [15/100], 训练损失: 1.0133, 验证损失: 0.9605, 验证 R2 (标准化): -0.0000
2025-07-23 14:36:50,554 - INFO - Epoch [16/100], 训练损失: 1.0133, 验证损失: 0.9606, 验证 R2 (标准化): -0.0001
2025-07-23 14:36:58,555 - INFO - Epoch [17/100], 训练损失: 1.0133, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:37:06,599 - INFO - Epoch [18/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:37:14,750 - INFO - Epoch [19/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:37:22,854 - INFO - Epoch [20/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:37:30,981 - INFO - Epoch [21/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:37:39,097 - INFO - Epoch [22/100], 训练损失: 1.0132, 验证损失: 0.9608, 验证 R2 (标准化): -0.0004
2025-07-23 14:37:47,254 - INFO - Epoch [23/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:37:55,321 - INFO - Epoch [24/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:38:03,495 - INFO - Epoch [25/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:38:11,661 - INFO - Epoch [26/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:38:19,837 - INFO - Epoch [27/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:38:27,917 - INFO - Epoch [28/100], 训练损失: 1.0131, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:38:35,896 - INFO - Epoch [29/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:38:43,858 - INFO - Epoch [30/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:38:43,858 - INFO - 早停！验证损失在 15 个epoch内没有显著改善。
2025-07-23 14:38:43,862 - INFO - --- 模型训练完成 ---
2025-07-23 14:38:44,010 - INFO - 图表已保存到: logs\训练与验证损失曲线.png
2025-07-23 14:39:01,960 - INFO - 图表已保存到: logs\验证集R2分数曲线.png
2025-07-23 14:39:08,423 - INFO - Trial 1: 选择了 FT-Transformer 模型
2025-07-23 14:39:08,423 - INFO - 
--- 模型训练开始 ---
2025-07-23 14:39:17,951 - INFO - Epoch [1/100], 训练损失: 19.6720, 验证损失: 0.9610, 验证 R2 (标准化): -0.0005
2025-07-23 14:39:26,977 - INFO - Epoch [2/100], 训练损失: 1.0143, 验证损失: 0.9612, 验证 R2 (标准化): -0.0008
2025-07-23 14:39:36,050 - INFO - Epoch [3/100], 训练损失: 1.0135, 验证损失: 0.9608, 验证 R2 (标准化): -0.0003
2025-07-23 14:39:45,134 - INFO - Epoch [4/100], 训练损失: 1.0133, 验证损失: 0.9607, 验证 R2 (标准化): -0.0002
2025-07-23 14:39:54,352 - INFO - Epoch [5/100], 训练损失: 1.0142, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:40:03,667 - INFO - Epoch [6/100], 训练损失: 1.0137, 验证损失: 0.9605, 验证 R2 (标准化): -0.0001
2025-07-23 14:40:12,960 - INFO - Epoch [7/100], 训练损失: 1.0136, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:40:22,151 - INFO - Epoch [8/100], 训练损失: 1.0134, 验证损失: 0.9605, 验证 R2 (标准化): -0.0001
2025-07-23 14:40:31,380 - INFO - Epoch [9/100], 训练损失: 1.0950, 验证损失: 0.9609, 验证 R2 (标准化): -0.0005
2025-07-23 14:40:40,574 - INFO - Epoch [10/100], 训练损失: 1.0138, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:40:49,738 - INFO - Epoch [11/100], 训练损失: 1.0135, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:40:58,895 - INFO - Epoch [12/100], 训练损失: 1.0134, 验证损失: 0.9605, 验证 R2 (标准化): -0.0000
2025-07-23 14:41:08,198 - INFO - Epoch [13/100], 训练损失: 1.0854, 验证损失: 0.9611, 验证 R2 (标准化): -0.0007
2025-07-23 14:41:17,507 - INFO - Epoch [14/100], 训练损失: 1.0142, 验证损失: 0.9609, 验证 R2 (标准化): -0.0005
2025-07-23 14:41:26,873 - INFO - Epoch [15/100], 训练损失: 1.0133, 验证损失: 0.9608, 验证 R2 (标准化): -0.0003
2025-07-23 14:41:36,184 - INFO - Epoch [16/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0001
2025-07-23 14:41:45,408 - INFO - Epoch [17/100], 训练损失: 1.0134, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:41:54,687 - INFO - Epoch [18/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0001
2025-07-23 14:42:03,965 - INFO - Epoch [19/100], 训练损失: 1.0132, 验证损失: 0.9607, 验证 R2 (标准化): -0.0002
2025-07-23 14:42:13,190 - INFO - Epoch [20/100], 训练损失: 1.0132, 验证损失: 0.9609, 验证 R2 (标准化): -0.0005
2025-07-23 14:42:22,493 - INFO - Epoch [21/100], 训练损失: 1.0134, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:42:31,844 - INFO - Epoch [22/100], 训练损失: 1.0133, 验证损失: 0.9605, 验证 R2 (标准化): -0.0000
2025-07-23 14:42:41,215 - INFO - Epoch [23/100], 训练损失: 1.0132, 验证损失: 0.9606, 验证 R2 (标准化): -0.0002
2025-07-23 14:42:50,538 - INFO - Epoch [24/100], 训练损失: 1.0132, 验证损失: 0.9607, 验证 R2 (标准化): -0.0002
2025-07-23 14:42:59,932 - INFO - Epoch [25/100], 训练损失: 1.0096, 验证损失: 0.9205, 验证 R2 (标准化): 0.0416
2025-07-23 14:43:10,342 - INFO - Epoch [26/100], 训练损失: 0.5017, 验证损失: 0.3816, 验证 R2 (标准化): 0.6027
2025-07-23 14:43:20,818 - INFO - Epoch [27/100], 训练损失: 0.3730, 验证损失: 0.3287, 验证 R2 (标准化): 0.6577
2025-07-23 14:43:30,563 - INFO - Epoch [28/100], 训练损失: 0.3356, 验证损失: 0.3262, 验证 R2 (标准化): 0.6604
2025-07-23 14:43:40,108 - INFO - Epoch [29/100], 训练损失: 0.3215, 验证损失: 0.3829, 验证 R2 (标准化): 0.6014
2025-07-23 14:43:49,707 - INFO - Epoch [30/100], 训练损失: 0.3031, 验证损失: 0.3754, 验证 R2 (标准化): 0.6091
2025-07-23 14:43:59,150 - INFO - Epoch [31/100], 训练损失: 0.2938, 验证损失: 0.2805, 验证 R2 (标准化): 0.7079
2025-07-23 14:44:08,609 - INFO - Epoch [32/100], 训练损失: 0.2867, 验证损失: 0.2752, 验证 R2 (标准化): 0.7135
